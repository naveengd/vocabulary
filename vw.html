<!DOCTYPE html>
<html>
<head>
  <title>Vocabulary</title>
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 90vh;
      color: #333;
      font-weight: 500;
      text-align: center;
      position: relative;
    }

    #lineWrapper {
      position: absolute;
      top: 75px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 90%;
    }

    #line {
      font-size: 60px;
      font-weight: 500;
    }

    #examples {
      margin-top: 40px;
      font-size: 28px;
      font-weight: 400;
      color: #555;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    /* Bottom bar container */
    #bottomBar {
      position: absolute;
      bottom: 5px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      align-items: center;
      gap: 20px; /* spacing between items */
      font-size: 14px;
    }

    /* Line number as inline-block to align with dropdowns */
    #lineNumber {
      display: inline-block;
      height: 26px;
      line-height: 26px; /* vertically centers text */
      text-align: center;
      font-size: 14px;
      width: 80px;
    }

    /* Dropdowns */
    #letterFilter, #delayInput, #shuffleDropdown {
      height: 26px;
      padding: 4px;
      border: none;
      text-align: center;
      font-size: 14px;
      width: 80px;
    }
  </style>
</head>
<body>
  <div id="lineWrapper">
    <div id="line"></div>
    <div id="examples"></div>
  </div>

  <!-- Bottom bar with all controls -->
  <div id="bottomBar">
    <span id="lineNumber"></span>
    <!-- Letter filter dropdown -->
    <select id="letterFilter" title="Filter by letter">
      <option value="-">-</option>
      <script>
        for (let i = 97; i <= 122; i++) {
          document.write(`<option value="${String.fromCharCode(i)}">${String.fromCharCode(i)}</option>`);
        }
      </script>
    </select>

    <!-- Delay dropdown -->
    <select id="delayInput" title="Delay in seconds">
      <option value="0" selected>0</option>
      <option value="2">2</option>
      <option value="6">6</option>
      <option value="9">9</option>
    </select>

    <!-- Shuffle dropdown -->
    <select id="shuffleDropdown" title="Shuffle lines">
      <option value="no" selected>No</option>
      <option value="yes">Yes</option>
    </select>
  </div>

  <script>
    const text = `
a 1:a 1-start of group 1
a mountain of:I have a mountain of paperwork to finish before Friday. There’s a mountain of unpaid bills on the table. A mountain of problems
a step closer, one step closer:We’re a step closer to launching the new product. His approval brings us a step closer to finalising the deal. Learning a new language brought her one step closer to her dream job. The team's winning streak brought them one step closer to the championship
a truckload of:She came back from vacation with a truckload of work waiting for her. The library received a truckload of donated books for their summer sale
`;

    const lines = text.split(/\r?\n/).filter(x => x.trim());

    function shuffle(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    let filtered = [...lines];
    const lineDisplay = document.getElementById("line");
    const examplesDisplay = document.getElementById("examples");
    const lineNumberDisplay = document.getElementById("lineNumber");
    const delayInput = document.getElementById("delayInput");
    const letterFilter = document.getElementById("letterFilter");
    const shuffleDropdown = document.getElementById("shuffleDropdown");

    let index = 0;
    let interval = null;

    function getDelay() {
      return parseInt(delayInput.value, 10);
    }

    function isShuffleEnabled() {
      return shuffleDropdown.value === "yes";
    }

    function showLine() {
      if (index >= 0 && index < filtered.length) {
        const line = filtered[index];
        const parts = line.split(":");
        const key = parts[0] || "";
        const examples = parts[1] ? parts[1].split(".").map(e => e.trim()).filter(e => e) : [];

        lineDisplay.textContent = key;
        examplesDisplay.innerHTML = examples.map(e => `<div>${e}</div>`).join("");

        lineNumberDisplay.textContent = `${index + 1}/${filtered.length}`;
        document.title = key;
      } else {
        lineDisplay.textContent = "";
        examplesDisplay.innerHTML = "";
        lineNumberDisplay.textContent = `0/0`;
      }
    }

    function start() {
      const delay = getDelay();
      if (interval) {
        clearInterval(interval);
        interval = null;
      }
      if (delay === 0) return;
      interval = setInterval(() => {
        index++;
        if (index < filtered.length) {
          showLine();
        } else {
          clearInterval(interval);
          interval = null;
        }
      }, delay * 1000);
    }

    function applyFilter() {
      const selectedLetter = letterFilter.value;
      let newFiltered = selectedLetter === "-" ? [...lines] : lines.filter(l => l[0].toLowerCase() === selectedLetter);
      filtered = isShuffleEnabled() ? shuffle(newFiltered) : newFiltered;
      index = 0;
      showLine();
      start();
    }

    delayInput.addEventListener("change", start);
    letterFilter.addEventListener("change", applyFilter);
    shuffleDropdown.addEventListener("change", applyFilter);

    function prevLine() {
      if (index > 0) {
        index--;
        showLine();
      }
    }

    function nextLine() {
      if (index < filtered.length - 1) {
        index++;
        showLine();
      }
    }

    document.addEventListener("keydown", e => {
      if (e.code === "ArrowLeft" || e.code === "PageUp") prevLine();
      else if (e.code === "ArrowRight" || e.code === "PageDown") nextLine();
    });

    // ✅ Updated touchend handler with 15% inactive margins
    document.addEventListener("touchend", e => {
      const touchX = e.changedTouches[0].clientX;
      const screenWidth = window.innerWidth;
      const leftBoundary = screenWidth * 0.15;
      const rightBoundary = screenWidth * 0.85;
      const midPoint = screenWidth * 0.50;

      if (touchX < leftBoundary || touchX > rightBoundary) {
        return; // do nothing in 10% margins
      }

      if (touchX < midPoint) {
        prevLine();
      } else {
        nextLine();
      }
    });

    // Initial load
    applyFilter();
  </script>
</body>
</html>
